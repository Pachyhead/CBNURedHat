#include <stdio.h>
#include <conio.h>
#include <windows.h>
#include <stdlib.h>
#include <time.h>
#include <stdbool.h>

void init();
void gotoxy(int x, int y);
void drawMap(int x, int y);
void creatFood();
void confFood();
void sLoop();

typedef struct posi {
   int x;
   int y;
   bool exist;
} Posi;

Posi snake;
Posi food;

char map[17][17] = { 
   {"11111111111111111"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"10000000000000001"},
   {"11111111111111111"}
};

void init() {
   HANDLE consoleHandle = GetStdHandle(STD_OUTPUT_HANDLE);
   CONSOLE_CURSOR_INFO ConsoleCursor;
   ConsoleCursor.bVisible = 0;
   ConsoleCursor.dwSize = 1;
   SetConsoleCursorInfo(consoleHandle, &ConsoleCursor);
}

void drawMap(int x, int y) {
   system("cls");
   int col, line;
   confFood();
   gotoxy(0, 0);
   for (line = 0; line < 17; line++) {
      for (col = 0; col < 17; col++) {
         char temp = map[line][col];
         if (temp == '1') printf("▣");
         else if (temp == '0') printf("  ");
         else if (temp == 's') printf("ss");
         else if (temp == 'f') printf("ㅇ");
      }
      printf("\n");
   }

   Sleep(150);
}

void creatFood() {
   int x, y;
   srand(time(NULL));
   food.x = rand() % 15 + 1;
   food.y = rand() % 15 + 1;
   x = food.x;
   y = food.y;
   if (map[y][x] == '0') {
      map[y][x] = 'f';
      food.exist = true;
   }
}

void confFood() {
   int line, col, count=0;
   for (line = 0; line < 17; line++) {
      for (col = 0; col < 17; col++) {
         char temp = map[line][col];
         if (temp == 'f') count++;
      }
   }
   if (count > 0) food.exist = true;
   else {
      food.exist = false;
      creatFood();
   }
}

void sLoop() {
   int playing = 1;
   char temp;
   int x, y;
   snake.x = 8;
   snake.y = 7;

    while (playing) {
      x = snake.x; y = snake.y;
      map[y][x] = 's';
      drawMap(x, y);
      if (_kbhit()) {
         temp = _getch();
         switch (temp) {
            case 'w':
               map[y][x] = '0';
               snake.y -= 1;
               break;
            case 'a':
               map[y][x] = '0';
               snake.x -= 1;
               break;
            case 's':
               map[y][x] = '0';
               snake.y += 1;
               break;
            case 'd':
               map[y][x] = '0';
               snake.x += 1;
               break;
         }
      }
      if (snake.x == 0 || snake.x == 16 || snake.y == 0 || snake.y == 16) playing = 0;
   }
}

void gotoxy(int x, int y) {
   COORD pos = { x,y };
   SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), pos);
}

int main(void) {
   init();
   food.exist = false;
   sLoop();
   printf("스네이크 게임");
   return 0;
}
